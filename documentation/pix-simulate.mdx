---
title: "POST /v1/charges/{id}/simulate"
api: "POST https://api.debita.ai/v1/charges/{id}/simulate"
description: "Simula o pagamento de um PIX para testes no ambiente sandbox."
---

## Visão Geral

Simula o pagamento de uma cobrança PIX no ambiente sandbox para facilitar testes de integração. **Este endpoint só funciona no ambiente sandbox.**

<Warning>
Este endpoint é **apenas para ambiente sandbox**. Chaves de produção (`pk_live_`) não podem simular pagamentos.
</Warning>

## Parâmetros da Requisição

### Path Parameters

<ParamField path="id" type="string" required>
  ID da cobrança PIX a ser simulada
</ParamField>

### Headers Obrigatórios

<ParamField header="Authorization" type="string" required>
  Chave API sandbox no formato Bearer token
  ```
  Bearer pk_sandbox_sua_chave
  ```
</ParamField>

<ParamField header="Content-Type" type="string">
  Tipo de conteúdo da requisição
  ```
  application/json
  ```
</ParamField>

### Body Parameters

<ParamField body="status" type="string" required>
  Status da simulação: `paid` ou `failed`
</ParamField>

<ParamField body="paid_amount" type="integer">
  Valor pago em centavos (padrão: valor total da cobrança)
</ParamField>

<ParamField body="end_to_end_id" type="string">
  ID E2E do PIX simulado (gerado automaticamente se não fornecido)
</ParamField>

## Exemplo de Requisição

<RequestExample>

```bash Pagamento Bem-sucedido
curl -X POST https://api.debita.ai/v1/charges/chg_pix_abc123/simulate \
  -H "Authorization: Bearer pk_sandbox_sua_chave" \
  -H "Content-Type: application/json" \
  -d '{
    "status": "paid"
  }'
```

```bash Pagamento Falhado
curl -X POST https://api.debita.ai/v1/charges/chg_pix_abc123/simulate \
  -H "Authorization: Bearer pk_sandbox_sua_chave" \
  -H "Content-Type: application/json" \
  -d '{
    "status": "failed"
  }'
```

```bash Pagamento Parcial
curl -X POST https://api.debita.ai/v1/charges/chg_pix_abc123/simulate \
  -H "Authorization: Bearer pk_sandbox_sua_chave" \
  -H "Content-Type: application/json" \
  -d '{
    "status": "paid",
    "paid_amount": 5000
  }'
```

```javascript Node.js
const response = await fetch('https://api.debita.ai/v1/charges/chg_pix_abc123/simulate', {
  method: 'POST',
  headers: {
    'Authorization': 'Bearer pk_sandbox_sua_chave',
    'Content-Type': 'application/json'
  },
  body: JSON.stringify({
    status: 'paid'
  })
});

const result = await response.json();
console.log('Simulação realizada:', result.status);
```

</RequestExample>

## Resposta

<ResponseExample>

```json Sucesso (200)
{
  "id": "chg_pix_abc123",
  "status": "paid",
  "amount": 10000,
  "paid_amount": 10000,
  "description": "Pagamento PIX",
  "method": "pix",
  "simulation": {
    "simulated_at": "2024-01-01T10:05:00-03:00",
    "end_to_end_id": "E12345678202401011005000000001",
    "payer_name": "Simulação Sandbox",
    "payer_document": "000.000.000-00"
  },
  "customer": {
    "id": "cust_def456",
    "name": "João Silva",
    "document": "123.456.789-09"
  },
  "paid_at": "2024-01-01T10:05:00-03:00",
  "created_at": "2024-01-01T10:00:00-03:00"
}
```

```json Erro - Ambiente Produção (403)
{
  "error": {
    "type": "forbidden_error",
    "code": "SIMULATION_NOT_ALLOWED",
    "message": "Payment simulation is only allowed in sandbox environment"
  }
}
```

```json Erro - Cobrança Já Paga (400)
{
  "error": {
    "type": "validation_error",
    "code": "CHARGE_ALREADY_PAID",
    "message": "This charge has already been paid",
    "field": "id"
  }
}
```

</ResponseExample>

## Campos da Resposta

<ResponseField name="simulation" type="object">
  Dados específicos da simulação (apenas no sandbox)

  <Expandable title="Propriedades da simulation">
    <ResponseField name="simulated_at" type="string">
      Data/hora da simulação
    </ResponseField>
    <ResponseField name="end_to_end_id" type="string">
      ID E2E gerado para a simulação
    </ResponseField>
    <ResponseField name="payer_name" type="string">
      Nome do pagador simulado
    </ResponseField>
    <ResponseField name="payer_document" type="string">
      Documento do pagador simulado
    </ResponseField>
  </Expandable>
</ResponseField>

## Comportamento de Webhooks

Após a simulação, os webhooks configurados serão disparados normalmente:

- **Pagamento bem-sucedido**: `charge.payment.confirmed`
- **Pagamento falhado**: `charge.payment.failed`

## Cenários de Teste

### ✅ Pagamento Completo
```json
{
  "status": "paid"
}
```

### ⚠️ Pagamento Parcial
```json
{
  "status": "paid",
  "paid_amount": 5000  // Metade do valor
}
```

### ❌ Pagamento Falhado
```json
{
  "status": "failed"
}
```