---
title: "Vis√£o Geral da Autentica√ß√£o"
description: "Como autenticar suas requisi√ß√µes na API Debita AI usando chaves Bearer e headers obrigat√≥rios."
---

# Autentica√ß√£o na API Debita AI

A API Debita AI utiliza **Bearer Token Authentication** com chaves API que identificam automaticamente o ambiente de execu√ß√£o baseado no prefixo da chave.

## üîë Tipos de Chaves API

A Debita AI oferece diferentes tipos de chaves API para diferentes casos de uso:

<CardGroup cols={3}>
  <Card title="Developer Sandbox" icon="flask">
    **pk_sandbox_**

    Ambiente de desenvolvimento com dados fict√≠cios e limites altos. Ideal para integra√ß√£o inicial.
  </Card>
  <Card title="Test" icon="bug">
    **pk_test_**

    Ambiente de homologa√ß√£o com dados reais mas sem cobran√ßa efetiva.
  </Card>
  <Card title="Live" icon="shield-check">
    **pk_live_**

    Ambiente de produ√ß√£o com transa√ß√µes reais e cobran√ßa efetiva.
  </Card>
</CardGroup>

## üéØ Detec√ß√£o Autom√°tica de Ambiente

A API detecta automaticamente o ambiente baseado no prefixo da sua chave:

```javascript
// Ambiente ser√° automaticamente detectado
const apiKey = 'pk_sandbox_abc123...'; // ‚Üí Developer Sandbox
const apiKey = 'pk_test_abc123...';    // ‚Üí Test
const apiKey = 'pk_live_abc123...';    // ‚Üí Live
```

### Comportamentos por Ambiente

| Recurso | Developer Sandbox | Test | Live |
|---------|---------|------|------|
| **Rate Limiting** | 50.000 req/key | 10.000 req/key | 1.000 req/key |
| **Dados de Teste** | ‚úÖ Aceita CPF/CNPJ fict√≠cios | ‚ö†Ô∏è Precisa de dados v√°lidos | ‚ùå Apenas dados reais |
| **Pagamentos Reais** | ‚ùå Simulados | ‚ùå Simulados | ‚úÖ Reais |
| **Webhooks** | ‚úÖ Enviados | ‚úÖ Enviados | ‚úÖ Enviados |
| **Debug Headers** | ‚úÖ Dispon√≠veis | ‚úÖ Dispon√≠veis | ‚ùå N√£o dispon√≠veis |

## üîß Como Autenticar

### Header Authorization

Todas as requisi√ß√µes devem incluir o header `Authorization` com Bearer Token:

```http
Authorization: Bearer pk_sandbox_sua_chave_aqui
```

### Exemplo de Requisi√ß√£o

```javascript
const response = await fetch('https://api.debita.ai/v1/charges/pix/dynamic', {
  method: 'POST',
  headers: {
    'Authorization': 'Bearer pk_sandbox_sua_chave_aqui',
    'Content-Type': 'application/json',
    'Idempotency-Key': generateUuid()
  },
  body: JSON.stringify({
    amount: 10000,
    description: 'Pagamento teste'
  })
});
```

## üìã Headers Obrigat√≥rios

### Authorization (Obrigat√≥rio)
```http
Authorization: Bearer {sua_chave_api}
```

### Content-Type (Obrigat√≥rio para POST/PUT)
```http
Content-Type: application/json
```

### Idempotency-Key (Recomendado)
```http
Idempotency-Key: 550e8400-e29b-41d4-a716-446655440000
```

<Warning>
**Idempot√™ncia**: Use `Idempotency-Key` √∫nico para evitar cobran√ßas duplicadas em caso de timeout ou erro de rede. Use UUIDs v4.
</Warning>

## ‚ö° Rate Limiting

A API aplica limites diferentes baseados no tipo de chave:

### Limites por Ambiente

| Ambiente | Requests por Chave | Observa√ß√µes |
|----------|-------------------|-------------|
| **Developer Sandbox** | 50.000 | Limite alto para desenvolvimento |
| **Test** | 10.000 | Para homologa√ß√£o |
| **Live** | 1.000 | Produ√ß√£o com limite controlado |

### Headers de Rate Limit

A API retorna headers informativos sobre o rate limiting:

```http
X-RateLimit-Limit: 50000
X-RateLimit-Remaining: 49995
X-RateLimit-Reset: 1640995200
```

### Tratamento de Rate Limit

Quando o limite √© excedido, a API retorna status `429`:

```json
{
  "error": {
    "type": "rate_limit_exceeded",
    "message": "Too many requests. Limit exceeded for your API key",
    "retry_after": 3600
  }
}
```

## üîê Seguran√ßa

### HTTPS Obrigat√≥rio

Todas as requisi√ß√µes devem usar HTTPS. HTTP n√£o √© suportado:

```javascript
// ‚úÖ Correto
const url = 'https://api.debita.ai/v1/charges';

// ‚ùå Incorreto - gerar√° erro
const url = 'http://api.debita.ai/v1/charges';
```

### Valida√ß√£o de Chave

A API valida o formato e assinatura da chave em cada requisi√ß√£o:

```javascript
// ‚úÖ Formatos v√°lidos
pk_sandbox_abc123def456ghi789  // Developer sandbox
pk_test_abc123def456ghi789     // Test environment
pk_live_abc123def456ghi789     // Production

// ‚ùå Formatos inv√°lidos
sandbox_abc123     // Falta prefixo pk_
pk_invalid_abc     // Prefixo n√£o reconhecido
pk_test_123        // Muito curto (m√≠nimo 32 chars ap√≥s prefixo)
```

## üåç URLs de Ambiente

### API Base URL
```
https://api.debita.ai
```

<Info>
**URL √önica**: Diferente de outras APIs, a Debita AI usa uma √∫nica URL base. O ambiente √© detectado automaticamente pela chave API.
</Info>

### Endpoints Dispon√≠veis

```javascript
// Base da API
const BASE_URL = 'https://api.debita.ai/v1';

// Endpoints principais
const ENDPOINTS = {
  // PIX
  pixDynamic: `${BASE_URL}/charges/pix/dynamic`,
  pixStatic: `${BASE_URL}/charges/pix/static`,

  // Boleto
  boleto: `${BASE_URL}/charges/boleto`,

  // Clientes
  customers: `${BASE_URL}/customers`,

  // Webhooks
  webhooks: `${BASE_URL}/webhooks`
};
```

## üîÑ Exemplo Completo

### Node.js
```javascript
const axios = require('axios');
const { v4: uuidv4 } = require('uuid');

class DebitaClient {
  constructor(apiKey) {
    this.apiKey = apiKey;
    this.baseURL = 'https://api.debita.ai/v1';

    // Detectar ambiente automaticamente
    this.environment = this.detectEnvironment(apiKey);
  }

  detectEnvironment(key) {
    if (key.startsWith('pk_sandbox_')) return 'developer-sandbox';
    if (key.startsWith('pk_test_')) return 'test';
    if (key.startsWith('pk_live_')) return 'live';
    throw new Error('Chave API inv√°lida');
  }

  async request(method, endpoint, data = null) {
    const headers = {
      'Authorization': `Bearer ${this.apiKey}`,
      'Content-Type': 'application/json',
    };

    // Adicionar Idempotency-Key para opera√ß√µes de escrita
    if (['POST', 'PUT', 'PATCH'].includes(method.toUpperCase())) {
      headers['Idempotency-Key'] = uuidv4();
    }

    try {
      const response = await axios({
        method,
        url: `${this.baseURL}${endpoint}`,
        data,
        headers,
        timeout: 30000 // 30 segundos
      });

      return response.data;
    } catch (error) {
      if (error.response?.status === 429) {
        const retryAfter = error.response.headers['retry-after'] || 60;
        throw new Error(`Rate limit excedido. Tente novamente em ${retryAfter} segundos.`);
      }
      throw error;
    }
  }

  async createPixCharge(data) {
    return this.request('POST', '/charges/pix/dynamic', data);
  }
}

// Uso
const client = new DebitaClient('pk_sandbox_sua_chave_aqui');

async function exemploUso() {
  try {
    const charge = await client.createPixCharge({
      amount: 10000,
      description: 'Pagamento teste',
      customer: {
        name: 'Jo√£o Silva',
        document: '111.444.777-35',
        email: 'joao@email.com'
      }
    });

    console.log('Cobran√ßa criada:', charge);
  } catch (error) {
    console.error('Erro:', error.message);
  }
}
```

### Python
```python
import requests
import uuid
from typing import Optional, Dict, Any

class DebitaClient:
    def __init__(self, api_key: str):
        self.api_key = api_key
        self.base_url = 'https://api.debita.ai/v1'
        self.environment = self._detect_environment(api_key)

    def _detect_environment(self, key: str) -> str:
        if key.startswith('pk_sandbox_'):
            return 'developer-sandbox'
        elif key.startswith('pk_test_'):
            return 'test'
        elif key.startswith('pk_live_'):
            return 'live'
        else:
            raise ValueError('Chave API inv√°lida')

    def request(self, method: str, endpoint: str, data: Optional[Dict[Any, Any]] = None):
        headers = {
            'Authorization': f'Bearer {self.api_key}',
            'Content-Type': 'application/json'
        }

        # Adicionar Idempotency-Key para opera√ß√µes de escrita
        if method.upper() in ['POST', 'PUT', 'PATCH']:
            headers['Idempotency-Key'] = str(uuid.uuid4())

        url = f"{self.base_url}{endpoint}"

        try:
            response = requests.request(
                method=method,
                url=url,
                json=data,
                headers=headers,
                timeout=30
            )
            response.raise_for_status()
            return response.json()

        except requests.exceptions.HTTPError as e:
            if e.response.status_code == 429:
                retry_after = e.response.headers.get('retry-after', 60)
                raise Exception(f'Rate limit excedido. Tente novamente em {retry_after} segundos.')
            raise

    def create_pix_charge(self, data: Dict[str, Any]):
        return self.request('POST', '/charges/pix/dynamic', data)

# Uso
client = DebitaClient('pk_sandbox_sua_chave_aqui')

charge = client.create_pix_charge({
    'amount': 10000,
    'description': 'Pagamento teste',
    'customer': {
        'name': 'Jo√£o Silva',
        'document': '111.444.777-35',
        'email': 'joao@email.com'
    }
})

print(f"Cobran√ßa criada: {charge}")
```

## üö® Erros Comuns

### 401 - Unauthorized
```json
{
  "error": {
    "type": "unauthorized",
    "message": "Invalid API key"
  }
}
```

**Causa**: Chave API inv√°lida ou malformada
**Solu√ß√£o**: Verifique se a chave est√° correta e inclui o prefixo adequado

### 403 - Forbidden
```json
{
  "error": {
    "type": "forbidden",
    "message": "API key does not have permission for this operation"
  }
}
```

**Causa**: Chave n√£o tem permiss√£o para a opera√ß√£o
**Solu√ß√£o**: Verifique se est√° usando a chave correta para o ambiente

### 429 - Rate Limit Exceeded
```json
{
  "error": {
    "type": "rate_limit_exceeded",
    "message": "Too many requests",
    "retry_after": 60
  }
}
```

**Causa**: Muitas requisi√ß√µes em pouco tempo
**Solu√ß√£o**: Implemente retry com backoff exponencial

---

<Tip>
**Pr√≥ximos Passos**: Agora que voc√™ entende a autentica√ß√£o, configure os [ambientes de sandbox e produ√ß√£o](/autenticacao/ambientes).
</Tip>