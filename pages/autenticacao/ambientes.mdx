---
title: "Autentica√ß√£o API"
description: "Como autenticar nas APIs da Debita AI usando API Keys para desenvolvimento e integra√ß√£o."
---

# Autentica√ß√£o e API Keys

A Debita AI usa duas formas de autentica√ß√£o dependendo do contexto:

## üîê Autentica√ß√£o Dashboard (Firebase + Cookie)

Para usu√°rios acessando o dashboard e aplica√ß√µes web:

1. **Firebase Authentication**: Autentica√ß√£o inicial com Google/email
2. **HttpOnly Cookie**: Sess√£o segura criada ap√≥s login

```javascript
// Ap√≥s login no Firebase
const response = await fetch('/auth/session', {
  method: 'POST',
  headers: {
    'Authorization': `Bearer ${firebaseToken}`,
    'Content-Type': 'application/json'
  }
});

// Cookie HTTPOnly √© automaticamente definido
// Sess√£o dura 7 dias
```

## üîë API Keys para Desenvolvimento

Para integra√ß√µes e desenvolvimento, use API Keys no ambiente sandbox:

### Formato das Chaves

```
pk_sandbox_[64_chars_hex]
```

**Exemplo:**
```
pk_sandbox_a1b2c3d4e5f6789012345678901234567890123456789012345678901234
```

### Como Obter uma API Key

1. Acesse o dashboard da Debita AI
2. V√° em **Configura√ß√µes** ‚Üí **API Keys**
3. Clique em **Criar Nova Chave**
4. Defina um nome (ex: "Desenvolvimento Local")
5. **Importante**: Salve a chave imediatamente - ela s√≥ √© mostrada uma vez!

### Autentica√ß√£o com API Key

```javascript
const headers = {
  'Authorization': `Bearer pk_sandbox_abc123...`,
  'Content-Type': 'application/json'
};

const response = await fetch('https://api.debita.ai/charges', {
  method: 'POST',
  headers,
  body: JSON.stringify({
    amount: 10000,
    description: 'Teste PIX',
    // ...
  })
});
```

### Permiss√µes Dispon√≠veis

As API Keys podem ter diferentes permiss√µes:

- `payments:read` - Visualizar pagamentos
- `payments:write` - Criar/modificar pagamentos
- `customers:read` - Visualizar clientes
- `customers:write` - Criar/modificar clientes

### Rate Limiting

**Limite atual: 50.000 requests** por chave de desenvolvimento

```javascript
// Headers de resposta indicam limite
HTTP/1.1 200 OK
X-RateLimit-Limit: 50000
X-RateLimit-Remaining: 49999
X-RateLimit-Reset: 1640995200
```

## üîí Seguran√ßa das API Keys

### ‚úÖ Boas Pr√°ticas

- **Mantenha em vari√°veis de ambiente**:
  ```bash
  # .env
  DEBITA_API_KEY=pk_sandbox_abc123...
  ```

- **Use HTTPS sempre**:
  ```javascript
  // ‚úÖ Correto
  const baseURL = 'https://api.debita.ai';

  // ‚ùå NUNCA usar HTTP
  const baseURL = 'http://api.debita.ai';
  ```

- **Rotacione periodicamente** (recomendado: a cada 90 dias)

### ‚ùå O que N√ÉO fazer

- Nunca commite chaves no Git
- N√£o use em frontend p√∫blico (client-side)
- N√£o compartilhe em logs ou URLs
- N√£o hardcode nas aplica√ß√µes

```javascript
// ‚ùå NUNCA fa√ßa isso
const API_KEY = 'pk_sandbox_abc123...'; // hardcoded!

// ‚úÖ Use vari√°veis de ambiente
const API_KEY = process.env.DEBITA_API_KEY;
```

## üìä Monitoramento de Uso

### Estat√≠sticas Dispon√≠veis

- **√öltimo uso**: Quando a chave foi usada pela √∫ltima vez
- **Contador de uso**: Total de requests feitos
- **Rate limit**: Requests restantes no per√≠odo

### Via Dashboard

Monitore o uso das suas chaves em **Configura√ß√µes** ‚Üí **API Keys**:

- üìä Total de requests
- ‚è∞ √öltimo acesso
- üö¶ Status da chave (ativa/inativa)

### Via Headers de Resposta

```javascript
const response = await fetch('/api/endpoint', { headers });

console.log(response.headers.get('X-RateLimit-Remaining'));
console.log(response.headers.get('X-RateLimit-Reset'));
```

## üõ†Ô∏è Implementa√ß√£o Pr√°tica

### Cliente HTTP Configurado

```javascript
class DebitaClient {
  constructor(apiKey) {
    if (!apiKey || !apiKey.startsWith('pk_sandbox_')) {
      throw new Error('API key inv√°lida. Use pk_sandbox_...');
    }

    this.apiKey = apiKey;
    this.baseURL = 'https://api.debita.ai';
  }

  async request(endpoint, options = {}) {
    const headers = {
      'Authorization': `Bearer ${this.apiKey}`,
      'Content-Type': 'application/json',
      ...options.headers
    };

    const response = await fetch(`${this.baseURL}${endpoint}`, {
      ...options,
      headers
    });

    if (!response.ok) {
      throw new Error(`API Error: ${response.status}`);
    }

    return response.json();
  }

  // M√©todos espec√≠ficos
  async createPixCharge(data) {
    return this.request('/charges', {
      method: 'POST',
      body: JSON.stringify(data)
    });
  }
}

// Uso
const client = new DebitaClient(process.env.DEBITA_API_KEY);
const charge = await client.createPixCharge({
  amount: 10000,
  description: 'Pagamento teste'
});
```

### Tratamento de Erros de Autentica√ß√£o

```javascript
async function handleApiCall() {
  try {
    const response = await debitaClient.request('/charges');
    return response;
  } catch (error) {
    if (error.status === 401) {
      console.error('‚ùå API Key inv√°lida ou expirada');
      // Redirecionar para renova√ß√£o de chave
    } else if (error.status === 429) {
      console.error('‚è±Ô∏è Rate limit excedido');
      // Implementar backoff/retry
    } else {
      console.error('üö® Erro na API:', error.message);
    }
    throw error;
  }
}
```

## üîÑ Gerenciamento de Chaves

### Cria√ß√£o via Dashboard

1. **Nome descritivo**: "Desenvolvimento Local", "Staging", etc.
2. **Permiss√µes espec√≠ficas**: S√≥ o necess√°rio para cada uso
3. **Backup da chave**: Salve em gerenciador de senhas

### Revoga√ß√£o

Para revogar uma chave:
1. Acesse **Configura√ß√µes** ‚Üí **API Keys**
2. Clique em **Excluir** na chave desejada
3. **Efeito imediato**: Todas as requests falhar√£o com 401

### Rota√ß√£o Segura

```bash
# 1. Crie nova chave no dashboard
DEBITA_API_KEY_NEW=pk_sandbox_new123...

# 2. Teste a nova chave
curl -H "Authorization: Bearer $DEBITA_API_KEY_NEW" \
     https://api.debita.ai/health

# 3. Atualize aplica√ß√£o
DEBITA_API_KEY=pk_sandbox_new123...

# 4. Revogue chave antiga no dashboard
```