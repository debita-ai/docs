---
title: "Ambiente Sandbox"
description: "Guia completo do ambiente de sandbox da Debita AI para desenvolvimento seguro com simula√ß√µes de pagamento e teste de integra√ß√µes."
---

# Ambiente Sandbox

O ambiente sandbox da Debita AI √© um ambiente completo e isolado para desenvolvimento e testes de integra√ß√µes, onde voc√™ pode simular todos os cen√°rios de pagamento sem movimentar dinheiro real.

## üéØ Caracter√≠sticas do Sandbox

<CardGroup cols={2}>
  <Card title="Zero Risco" icon="shield-check">
    Nenhuma transa√ß√£o real √© processada. Ambiente 100% seguro para testes.
  </Card>
  <Card title="API Completa" icon="code">
    Todas as funcionalidades da API de produ√ß√£o est√£o dispon√≠veis.
  </Card>
  <Card title="Webhooks Reais" icon="webhook">
    Sistema de webhooks funciona normalmente, permitindo testes completos.
  </Card>
  <Card title="Dados Fict√≠cios" icon="user-circle">
    Aceita CPFs e CNPJs de teste v√°lidos para simula√ß√µes.
  </Card>
</CardGroup>

## üîë Configura√ß√£o Inicial

### 1. Obter Chave de Sandbox

1. **Acesse** [dashboard.debita.ai](https://dashboard.debita.ai)
2. **Fa√ßa login** com sua conta Google
3. **Navegue** para "Configura√ß√µes > Chaves da API"
4. **Copie** sua chave de sandbox (come√ßa com `pk_sandbox_`)

```javascript
// Configura√ß√£o b√°sica
const DEBITA_API_KEY = 'pk_sandbox_abc123def456...';
const BASE_URL = 'https://api.debita.ai/v1';

// A API detecta automaticamente que √© sandbox pelo prefixo
```

### 2. Diferen√ßas do Ambiente de Produ√ß√£o

| Recurso | Sandbox | Produ√ß√£o |
|---------|---------|----------|
| **Transa√ß√µes** | Simuladas | Reais |
| **Rate Limit** | 50 req/min | 10 req/min |
| **Dados** | CPF/CNPJ fict√≠cios aceitos | Apenas dados reais |
| **Webhooks** | Enviados normalmente | Enviados normalmente |
| **Logs** | Debug detalhado | Essencial apenas |
| **Headers Debug** | Dispon√≠veis | Indispon√≠veis |

## üß™ Simula√ß√µes de Pagamento

### PIX - Simula√ß√£o Autom√°tica

No sandbox, pagamentos PIX s√£o automaticamente "pagos" ap√≥s alguns segundos:

```javascript
// Criar PIX em sandbox
const response = await fetch('https://api.debita.ai/v1/charges/pix/dynamic', {
  method: 'POST',
  headers: {
    'Authorization': 'Bearer pk_sandbox_sua_chave',
    'Content-Type': 'application/json'
  },
  body: JSON.stringify({
    amount: 10000, // R$ 100,00
    description: 'Teste de pagamento PIX',
    customer: {
      name: 'Jo√£o Teste',
      document: '111.444.777-35', // CPF fict√≠cio v√°lido
      email: 'joao@teste.com'
    }
  })
});

const charge = await response.json();

// O pagamento ser√° automaticamente confirmado em 3-10 segundos
// Webhook ser√° enviado normalmente
```

### Controlando Simula√ß√µes

Voc√™ pode controlar o comportamento da simula√ß√£o usando par√¢metros especiais:

```javascript
// Simular pagamento que falha
const chargeFalha = await criarPix({
  amount: 10000,
  description: 'Teste de falha',
  customer: {
    name: 'Falha Teste',
    document: '000.000.001-91'
  },
  metadata: {
    simulate_failure: 'INSUFFICIENT_FUNDS' // Simula saldo insuficiente
  }
});

// Simular pagamento que expira
const chargeExpira = await criarPix({
  amount: 5000,
  description: 'Teste de expira√ß√£o',
  expires_at: new Date(Date.now() + 30000).toISOString(), // 30 segundos
  metadata: {
    simulate_behavior: 'let_expire' // N√£o pagar automaticamente
  }
});

// Controlar timing da confirma√ß√£o
const chargeTiming = await criarPix({
  amount: 7500,
  description: 'Teste com timing espec√≠fico',
  metadata: {
    simulate_delay_seconds: '30' // Confirmar em exatamente 30 segundos
  }
});
```

### C√≥digos de Simula√ß√£o

| Metadata | Comportamento |
|----------|---------------|
| `simulate_failure: "INSUFFICIENT_FUNDS"` | Simula saldo insuficiente |
| `simulate_failure: "INVALID_ACCOUNT"` | Simula conta inv√°lida |
| `simulate_failure: "PAYMENT_REJECTED"` | Simula rejei√ß√£o do banco |
| `simulate_behavior: "let_expire"` | N√£o paga automaticamente |
| `simulate_delay_seconds: "X"` | Confirma em X segundos |
| `simulate_refund_delay: "X"` | Demora X segundos para processar reembolso |

## üõ†Ô∏è Ferramentas de Desenvolvimento

### Simulador de Pagamentos

Voc√™ pode usar a interface do dashboard para simular pagamentos manualmente:

1. **Acesse** [dashboard.debita.ai/sandbox](https://dashboard.debita.ai/sandbox)
2. **Cole** o ID da cobran√ßa
3. **Escolha** o comportamento desejado:
   - ‚úÖ **Confirmar** pagamento
   - ‚ùå **Falhar** com motivo espec√≠fico
   - ‚è∞ **Deixar** expirar
4. **Execute** a simula√ß√£o

### Headers de Debug

Em sandbox, voc√™ recebe headers extras com informa√ß√µes √∫teis:

```javascript
// Resposta da API em sandbox inclui headers de debug
const response = await criarCobranca();

console.log('Headers de debug:', {
  'X-Debug-Environment': response.headers['x-debug-environment'], // 'sandbox'
  'X-Debug-Request-Id': response.headers['x-debug-request-id'], // ID √∫nico da requisi√ß√£o
  'X-Debug-Processing-Time': response.headers['x-debug-processing-time'], // Tempo em ms
  'X-Debug-Simulated': response.headers['x-debug-simulated'], // 'true' se simulado
  'X-Debug-Rate-Limit-Remaining': response.headers['x-debug-rate-limit-remaining'] // Requisi√ß√µes restantes
});
```

### Logs Detalhados

```javascript
// Em sandbox, voc√™ pode ativar logs verbosos
const response = await fetch('https://api.debita.ai/v1/charges/pix/dynamic', {
  method: 'POST',
  headers: {
    'Authorization': 'Bearer pk_sandbox_sua_chave',
    'Content-Type': 'application/json',
    'X-Debug-Verbose': 'true' // Ativa logs detalhados
  },
  body: JSON.stringify(payload)
});

// Response incluir√° campo 'debug' com informa√ß√µes extras
const data = await response.json();
console.log('Debug info:', data.debug);
```

## üîÑ Testando Webhooks

### Configura√ß√£o de Webhook para Testes

```javascript
// Registrar webhook apontando para localhost (use ngrok)
const webhook = await fetch('https://api.debita.ai/v1/webhooks', {
  method: 'POST',
  headers: {
    'Authorization': 'Bearer pk_sandbox_sua_chave',
    'Content-Type': 'application/json'
  },
  body: JSON.stringify({
    url: 'https://abc123.ngrok.io/webhooks/debita',
    events: ['payment.confirmed', 'payment.failed', 'payment.expired'],
    description: 'Webhook de desenvolvimento'
  })
});

const webhookData = await webhook.json();
console.log('Webhook criado:', webhookData.id);
console.log('Secret:', webhookData.secret); // Salve este secret!
```

### Testando Webhooks com ngrok

```bash
# 1. Instalar ngrok
npm install -g ngrok

# 2. Rodar servidor local na porta 3000
node server.js &

# 3. Expor com ngrok
ngrok http 3000

# 4. Usar URL do ngrok no webhook
# Exemplo: https://abc123.ngrok.io
```

### Servidor de Teste para Webhook

```javascript
// test-webhook-server.js
const express = require('express');
const crypto = require('crypto');

const app = express();
app.use(express.raw({ type: 'application/json' }));

// Endpoint para receber webhooks
app.post('/webhooks/debita', (req, res) => {
  console.log('\n=== WEBHOOK RECEBIDO ===');
  console.log('Timestamp:', new Date().toISOString());
  console.log('Headers:', JSON.stringify(req.headers, null, 2));

  try {
    // Validar assinatura (use o secret do webhook)
    const signature = req.headers['x-debita-signature'];
    const timestamp = req.headers['x-debita-timestamp'];
    const secret = process.env.WEBHOOK_SECRET;

    if (validateWebhook(req.body, signature, timestamp, secret)) {
      console.log('‚úÖ Assinatura v√°lida');

      const event = JSON.parse(req.body);
      console.log('Evento:', event.event);
      console.log('ID da cobran√ßa:', event.data.id);
      console.log('Status:', event.data.status);
      console.log('Valor:', event.data.amount);

      if (event.event === 'payment.confirmed') {
        console.log('üéâ PAGAMENTO CONFIRMADO!');
        console.log('End-to-End ID:', event.data.pix?.end_to_end_id);
      }

      res.status(200).send('OK');
    } else {
      console.log('‚ùå Assinatura inv√°lida');
      res.status(401).send('Invalid signature');
    }
  } catch (error) {
    console.error('‚ùå Erro ao processar webhook:', error.message);
    res.status(400).send('Error');
  }

  console.log('========================\n');
});

function validateWebhook(payload, signature, timestamp, secret) {
  const hmac = crypto.createHmac('sha256', secret);
  hmac.update(timestamp + '.' + payload);
  const expectedSignature = 'sha256=' + hmac.digest('hex');

  return crypto.timingSafeEqual(
    Buffer.from(expectedSignature),
    Buffer.from(signature)
  );
}

const port = 3000;
app.listen(port, () => {
  console.log(`üöÄ Servidor de teste rodando na porta ${port}`);
  console.log(`üì° Use ngrok para expor: ngrok http ${port}`);
});
```

## üìä Monitoramento em Sandbox

### Dashboard de Desenvolvimento

```javascript
// Consultar estat√≠sticas de sandbox
async function getStatsDesenvolvimento() {
  const response = await fetch('https://api.debita.ai/v1/dev/stats', {
    headers: {
      'Authorization': 'Bearer pk_sandbox_sua_chave'
    }
  });

  const stats = await response.json();
  return {
    totalCharges: stats.total_charges,
    successfulPayments: stats.successful_payments,
    failedPayments: stats.failed_payments,
    webhooksDelivered: stats.webhooks_delivered,
    averageResponseTime: stats.average_response_time
  };
}

// Limpar dados de teste
async function limparDadosTeste() {
  const response = await fetch('https://api.debita.ai/v1/dev/clear', {
    method: 'DELETE',
    headers: {
      'Authorization': 'Bearer pk_sandbox_sua_chave'
    }
  });

  return response.ok;
}
```

### Logs de Desenvolvimento

```javascript
// Consultar logs detalhados (apenas sandbox)
async function getLogs(filtros = {}) {
  const params = new URLSearchParams({
    start_date: filtros.startDate || new Date(Date.now() - 24 * 60 * 60 * 1000).toISOString(),
    end_date: filtros.endDate || new Date().toISOString(),
    event_type: filtros.eventType || 'all',
    limit: filtros.limit || '100'
  });

  const response = await fetch(`https://api.debita.ai/v1/dev/logs?${params}`, {
    headers: {
      'Authorization': 'Bearer pk_sandbox_sua_chave'
    }
  });

  return await response.json();
}

// Exemplo de uso
const logs = await getLogs({
  eventType: 'payment.confirmed',
  limit: '50'
});

console.log('√öltimos pagamentos confirmados:', logs);
```

## üöÄ Migra√ß√£o para Produ√ß√£o

### Checklist de Migra√ß√£o

<Steps>
  <Step title="Testar todos os fluxos">
    ‚úÖ PIX din√¢mico, est√°tico e com fiador
    ‚úÖ Boleto tradicional e h√≠brido
    ‚úÖ Webhooks de todos os eventos
    ‚úÖ Cen√°rios de falha e expira√ß√£o
  </Step>

  <Step title="Validar dados">
    ‚úÖ Substituir dados fict√≠cios por reais
    ‚úÖ Validar CPF/CNPJ reais
    ‚úÖ Testar com dados de clientes reais (pequenos valores)
  </Step>

  <Step title="Configurar produ√ß√£o">
    ‚úÖ Obter chave `pk_live_` no dashboard
    ‚úÖ Configurar webhook de produ√ß√£o (HTTPS obrigat√≥rio)
    ‚úÖ Implementar rate limiting (10 req/min)
    ‚úÖ Configurar monitoramento e alertas
  </Step>

  <Step title="Deploy seguro">
    ‚úÖ Deploy em ambiente de staging primeiro
    ‚úÖ Testes com valores baixos em produ√ß√£o
    ‚úÖ Monitorar m√©tricas de erro
    ‚úÖ Rollback preparado
  </Step>
</Steps>

### Diferen√ßas Importantes

```javascript
// Sandbox vs Produ√ß√£o
const config = {
  sandbox: {
    apiKey: 'pk_sandbox_...',
    rateLimit: 50, // req/min
    validation: 'relaxed', // Aceita CPF fict√≠cio
    simulation: true,
    debugging: true
  },
  production: {
    apiKey: 'pk_live_...',
    rateLimit: 10, // req/min
    validation: 'strict', // Apenas dados reais
    simulation: false,
    debugging: false
  }
};

// C√≥digo adaptativo
function getConfig() {
  const apiKey = process.env.DEBITA_API_KEY;

  if (apiKey.startsWith('pk_sandbox_')) {
    return config.sandbox;
  } else if (apiKey.startsWith('pk_live_')) {
    return config.production;
  } else {
    throw new Error('Chave API inv√°lida');
  }
}
```

---

<Tip>
**Pr√≥ximo Passo**: Explore [cen√°rios de teste](/testes/cenarios) espec√≠ficos para validar completamente sua integra√ß√£o antes da migra√ß√£o para produ√ß√£o.
</Tip>