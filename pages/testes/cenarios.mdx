---
title: "Cen√°rios de Teste"
description: "Cen√°rios de teste completos para validar integra√ß√µes PIX, Boleto e webhooks antes do deploy em produ√ß√£o."
---

# Cen√°rios de Teste

Esta se√ß√£o apresenta cen√°rios abrangentes para testar todas as funcionalidades da Debita AI antes de migrar para produ√ß√£o. Execute estes testes em ambiente sandbox para garantir que sua integra√ß√£o funciona perfeitamente.

## üéØ Estrutura dos Cen√°rios

Cada cen√°rio inclui:
- **Objetivo**: O que est√° sendo testado
- **Pr√©-requisitos**: Configura√ß√£o necess√°ria
- **Passos**: Sequ√™ncia de a√ß√µes
- **Resultado esperado**: O que deve acontecer
- **Valida√ß√£o**: Como verificar sucesso

## üí≥ Cen√°rios PIX

### 1. PIX Din√¢mico - Fluxo Completo

**Objetivo**: Validar cria√ß√£o, pagamento e webhook de PIX din√¢mico

**Pr√©-requisitos**:
- Chave de sandbox configurada
- Webhook configurado e funcionando
- Dados de teste v√°lidos

**Passos**:
```javascript
// Cen√°rio 1: PIX Din√¢mico Completo
async function cenarioPIXCompleto() {
  console.log('üß™ Cen√°rio: PIX Din√¢mico Completo');

  // 1. Criar cobran√ßa PIX
  const cobranca = await debitaClient.createPixCharge({
    amount: 15000, // R$ 150,00
    description: 'Teste E-commerce - Smartphone XYZ',
    customer: {
      name: 'Jo√£o Silva Santos',
      document: '111.444.777-35',
      email: 'joao.silva@teste.com',
      phone: '+5511999999999'
    },
    expires_at: new Date(Date.now() + 30 * 60 * 1000).toISOString(), // 30 min
    external_id: `ecommerce_test_${Date.now()}`,
    metadata: {
      categoria: 'eletronicos',
      teste: 'cenario_completo'
    }
  });

  console.log('‚úÖ Cobran√ßa criada:', cobranca.id);
  console.log('QR Code gerado:', cobranca.pix.qr_code ? '‚úì' : '‚úó');
  console.log('Expira em:', cobranca.pix.expires_at);

  // 2. Aguardar confirma√ß√£o autom√°tica (sandbox)
  console.log('‚è≥ Aguardando confirma√ß√£o autom√°tica...');
  await new Promise(resolve => setTimeout(resolve, 10000)); // 10 segundos

  // 3. Verificar status
  const status = await debitaClient.getChargeStatus(cobranca.id);
  console.log('Status atual:', status.status);

  return {
    cenario: 'PIX_DINAMICO_COMPLETO',
    sucesso: status.status === 'confirmed',
    cobranca_id: cobranca.id,
    tempo_confirmacao: '~10s'
  };
}
```

**Resultado Esperado**:
- Cobran√ßa criada com status `pending`
- QR Code v√°lido gerado
- Pagamento confirmado automaticamente em ~10s
- Webhook `payment.confirmed` recebido

**Valida√ß√£o**:
- Status final deve ser `confirmed`
- Webhook deve conter `end_to_end_id`
- Valor deve estar correto no webhook

---

### 2. PIX Est√°tico - M√∫ltiplos Pagamentos

**Objetivo**: Testar PIX est√°tico com m√∫ltiplos valores

```javascript
async function cenarioPIXEstatico() {
  console.log('üß™ Cen√°rio: PIX Est√°tico - M√∫ltiplos Valores');

  // 1. Criar PIX est√°tico
  const pixEstatico = await debitaClient.createPixStatic({
    description: 'Loja de Testes - Pagamentos Variados',
    merchant: {
      name: 'Loja de Testes Ltda',
      city: 'S√£o Paulo',
      document: '11.222.333/0001-81'
    },
    identifier: `loja_teste_${Date.now()}`,
    suggested_amounts: [1000, 2500, 5000, 10000],
    min_amount: 500,
    max_amount: 50000
  });

  console.log('‚úÖ PIX Est√°tico criado:', pixEstatico.id);
  console.log('QR Code reutiliz√°vel:', pixEstatico.pix.qr_code ? '‚úì' : '‚úó');

  // 2. Simular 3 pagamentos diferentes
  const valores = [1500, 3000, 7500]; // R$ 15, R$ 30, R$ 75
  const resultados = [];

  for (let i = 0; i < valores.length; i++) {
    console.log(`üí∞ Simulando pagamento ${i + 1}: R$ ${(valores[i] / 100).toFixed(2)}`);

    // Em sandbox, simule criando cobran√ßa din√¢mica com refer√™ncia
    const cobrancaSimulada = await debitaClient.createPixCharge({
      amount: valores[i],
      description: `Pagamento via PIX Est√°tico - Valor ${i + 1}`,
      customer: {
        name: `Cliente Teste ${i + 1}`,
        document: '123.456.789-09'
      },
      metadata: {
        pix_estatico_id: pixEstatico.id,
        valor_index: i + 1,
        teste: 'pix_estatico'
      }
    });

    await new Promise(resolve => setTimeout(resolve, 5000));
    const status = await debitaClient.getChargeStatus(cobrancaSimulada.id);

    resultados.push({
      valor: valores[i],
      status: status.status,
      cobranca_id: cobrancaSimulada.id
    });

    console.log(`‚úÖ Pagamento ${i + 1} ${status.status}`);
  }

  return {
    cenario: 'PIX_ESTATICO_MULTIPLOS',
    pix_estatico_id: pixEstatico.id,
    pagamentos: resultados,
    sucesso: resultados.every(r => r.status === 'confirmed')
  };
}
```

---

### 3. PIX com Fiador - B2B

**Objetivo**: Testar PIX com garantia para transa√ß√£o B2B

```javascript
async function cenarioPIXComFiador() {
  console.log('üß™ Cen√°rio: PIX com Fiador B2B');

  // 1. Criar PIX com fiador para contrato B2B
  const pixGarantido = await debitaClient.createPixGuaranteed({
    amount: 75000, // R$ 750,00
    description: 'Consultoria em Transforma√ß√£o Digital - 40h',
    customer: {
      name: 'TechCorp Solu√ß√µes Ltda',
      document: '12.345.678/0001-95',
      email: 'financeiro@techcorp.teste.com',
      phone: '+5511987654321'
    },
    guarantee_type: 'merchant_backed',
    contract_reference: 'CONT_TEST_2024_001',
    guarantee_amount: 75000,
    guarantee_period: 45, // 45 dias
    expires_at: new Date(Date.now() + 48 * 60 * 60 * 1000).toISOString(), // 48h
    external_id: `b2b_consultoria_${Date.now()}`,
    metadata: {
      tipo_contrato: 'consultoria',
      area: 'transformacao_digital',
      gestor: 'maria.gestora@empresa.com',
      teste: 'pix_com_fiador'
    }
  });

  console.log('‚úÖ PIX com fiador criado:', pixGarantido.id);
  console.log('Garantia ativa por:', pixGarantido.guarantee_period, 'dias');
  console.log('Fiador:', pixGarantido.guarantee.guarantor.name);

  // 2. Aguardar confirma√ß√£o
  await new Promise(resolve => setTimeout(resolve, 12000)); // 12 segundos

  // 3. Verificar status da garantia
  const status = await debitaClient.getChargeStatus(pixGarantido.id);
  const guarantee = await debitaClient.getGuaranteeStatus(pixGarantido.id);

  console.log('Status do pagamento:', status.status);
  console.log('Status da garantia:', guarantee.status);
  console.log('Garantia v√°lida at√©:', guarantee.active_until);

  return {
    cenario: 'PIX_COM_FIADOR',
    cobranca_id: pixGarantido.id,
    garantia_ativa: guarantee.status === 'active',
    pagamento_confirmado: status.status === 'confirmed',
    sucesso: status.status === 'confirmed' && guarantee.status === 'active'
  };
}
```

---

## üìÑ Cen√°rios Boleto

### 4. Boleto Tradicional

**Objetivo**: Testar cria√ß√£o e confirma√ß√£o de boleto banc√°rio

```javascript
async function cenarioBoletoTradicional() {
  console.log('üß™ Cen√°rio: Boleto Tradicional');

  // 1. Criar boleto com configura√ß√µes brasileiras
  const boleto = await debitaClient.createBoleto({
    amount: 25000, // R$ 250,00
    description: 'Curso Online - JavaScript Avan√ßado',
    due_date: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).toISOString(), // 7 dias
    customer: {
      name: 'Maria Oliveira Costa',
      document: '123.456.789-09',
      email: 'maria.oliveira@teste.com',
      phone: '+5521987654321',
      address: {
        street: 'Rua do Catete, 200',
        neighborhood: 'Catete',
        city: 'Rio de Janeiro',
        state: 'RJ',
        zipcode: '22220-000'
      }
    },
    fine_rate: 0.02, // 2% de multa
    interest_rate: 0.033, // 1% ao m√™s (0.033% ao dia)
    discount_rate: 0.05, // 5% desconto antecipado
    discount_limit_date: new Date(Date.now() + 3 * 24 * 60 * 60 * 1000).toISOString(),
    external_id: `curso_js_${Date.now()}`,
    metadata: {
      curso: 'javascript_avancado',
      categoria: 'educacao',
      teste: 'boleto_tradicional'
    }
  });

  console.log('‚úÖ Boleto criado:', boleto.id);
  console.log('C√≥digo de barras:', boleto.boleto.barcode ? '‚úì' : '‚úó');
  console.log('Linha digit√°vel:', boleto.boleto.digitable_line ? '‚úì' : '‚úó');
  console.log('Vencimento:', boleto.boleto.due_date);

  // 2. Em sandbox, simular pagamento ap√≥s 24h
  console.log('üí∞ Simulando pagamento de boleto...');

  // Simular delay de boleto (D+1)
  await new Promise(resolve => setTimeout(resolve, 8000));

  const status = await debitaClient.getChargeStatus(boleto.id);
  console.log('Status do boleto:', status.status);

  return {
    cenario: 'BOLETO_TRADICIONAL',
    boleto_id: boleto.id,
    codigo_barras_valido: !!boleto.boleto.barcode,
    vencimento_correto: new Date(boleto.boleto.due_date) > new Date(),
    pagamento_confirmado: status.status === 'confirmed',
    sucesso: status.status === 'confirmed'
  };
}
```

---

### 5. Boleto H√≠brido (Boleto + PIX)

```javascript
async function cenarioBoletoHibrido() {
  console.log('üß™ Cen√°rio: Boleto H√≠brido (Boleto + PIX)');

  const boletoHibrido = await debitaClient.createBoleto({
    amount: 35000, // R$ 350,00
    description: 'Assinatura Premium - 6 meses',
    due_date: new Date(Date.now() + 10 * 24 * 60 * 60 * 1000).toISOString(),
    customer: {
      name: 'Pedro Santos Lima',
      document: '000.000.001-91',
      email: 'pedro.santos@teste.com'
    },
    enable_pix: true, // PIX integrado
    pix_discount_rate: 0.03, // 3% desconto no PIX
    fine_rate: 0.02,
    interest_rate: 0.033,
    external_id: `premium_6m_${Date.now()}`,
    metadata: {
      tipo: 'assinatura',
      plano: 'premium',
      periodo: '6_meses',
      teste: 'boleto_hibrido'
    }
  });

  console.log('‚úÖ Boleto h√≠brido criado:', boletoHibrido.id);
  console.log('PIX habilitado:', boletoHibrido.boleto.pix_enabled);
  console.log('Desconto PIX:', boletoHibrido.boleto.pix_discount_rate);

  // Cliente pode escolher: pagar boleto OU PIX com desconto
  const valorComDesconto = boletoHibrido.amount * (1 - boletoHibrido.boleto.pix_discount_rate);
  console.log(`üí° Op√ß√µes de pagamento:
    - Boleto: R$ ${(boletoHibrido.amount / 100).toFixed(2)}
    - PIX: R$ ${(valorComDesconto / 100).toFixed(2)} (com desconto)`);

  // Simular pagamento via PIX (com desconto)
  await new Promise(resolve => setTimeout(resolve, 6000));

  const status = await debitaClient.getChargeStatus(boletoHibrido.id);

  return {
    cenario: 'BOLETO_HIBRIDO',
    boleto_id: boletoHibrido.id,
    pix_habilitado: boletoHibrido.boleto.pix_enabled,
    desconto_aplicado: boletoHibrido.boleto.pix_discount_rate,
    sucesso: status.status === 'confirmed'
  };
}
```

---

## üîî Cen√°rios de Webhook

### 6. Valida√ß√£o Completa de Webhooks

```javascript
async function cenarioWebhooksCompleto() {
  console.log('üß™ Cen√°rio: Webhooks - Todos os Eventos');

  const resultados = {
    payment_created: false,
    payment_confirmed: false,
    payment_failed: false,
    payment_expired: false
  };

  // Setup: servidor webhook mock
  const webhookServer = new WebhookMockServer();
  await webhookServer.start();

  try {
    // 1. Teste payment.created + payment.confirmed
    console.log('üì® Testando payment.created e payment.confirmed...');
    const cobrancaOK = await debitaClient.createPixCharge({
      amount: 5000,
      description: 'Teste webhook confirmed',
      customer: {
        name: 'Webhook Teste OK',
        document: '111.444.777-35'
      },
      external_id: `webhook_ok_${Date.now()}`
    });

    await new Promise(resolve => setTimeout(resolve, 8000));

    // 2. Teste payment.failed
    console.log('üì® Testando payment.failed...');
    const cobrancaFail = await debitaClient.createPixCharge({
      amount: 3000,
      description: 'Teste webhook failed',
      customer: {
        name: 'Webhook Teste Fail',
        document: '000.000.001-91'
      },
      external_id: `webhook_fail_${Date.now()}`,
      metadata: {
        simulate_failure: 'INSUFFICIENT_FUNDS'
      }
    });

    await new Promise(resolve => setTimeout(resolve, 8000));

    // 3. Teste payment.expired
    console.log('üì® Testando payment.expired...');
    const cobrancaExpire = await debitaClient.createPixCharge({
      amount: 2000,
      description: 'Teste webhook expired',
      expires_at: new Date(Date.now() + 10000).toISOString(), // 10 segundos
      customer: {
        name: 'Webhook Teste Expire',
        document: '999.999.999-87'
      },
      external_id: `webhook_expire_${Date.now()}`,
      metadata: {
        simulate_behavior: 'let_expire'
      }
    });

    await new Promise(resolve => setTimeout(resolve, 15000));

    // 4. Verificar webhooks recebidos
    const webhooksRecebidos = webhookServer.getReceivedWebhooks();

    resultados.payment_created = webhooksRecebidos.some(w => w.event === 'payment.created');
    resultados.payment_confirmed = webhooksRecebidos.some(w => w.event === 'payment.confirmed');
    resultados.payment_failed = webhooksRecebidos.some(w => w.event === 'payment.failed');
    resultados.payment_expired = webhooksRecebidos.some(w => w.event === 'payment.expired');

    console.log('üìä Resultados dos webhooks:', resultados);

    return {
      cenario: 'WEBHOOKS_COMPLETO',
      eventos_recebidos: Object.keys(resultados).filter(k => resultados[k]),
      todos_eventos_ok: Object.values(resultados).every(v => v === true),
      total_webhooks: webhooksRecebidos.length,
      sucesso: Object.values(resultados).every(v => v === true)
    };

  } finally {
    await webhookServer.stop();
  }
}

// Servidor mock para capturar webhooks
class WebhookMockServer {
  constructor() {
    this.webhooks = [];
    this.server = null;
  }

  async start() {
    const express = require('express');
    const app = express();

    app.use(express.raw({ type: 'application/json' }));

    app.post('/webhooks/debita', (req, res) => {
      const webhook = JSON.parse(req.body);
      this.webhooks.push({
        event: webhook.event,
        timestamp: new Date(),
        data: webhook.data
      });

      console.log(`üì® Webhook recebido: ${webhook.event}`);
      res.status(200).send('OK');
    });

    this.server = app.listen(3001);
    console.log('üöÄ Servidor webhook mock rodando na porta 3001');
  }

  async stop() {
    if (this.server) {
      this.server.close();
      console.log('‚èπÔ∏è  Servidor webhook mock parado');
    }
  }

  getReceivedWebhooks() {
    return this.webhooks;
  }
}
```

---

## üìä Cen√°rios de Performance

### 7. Teste de Rate Limiting

```javascript
async function cenarioRateLimiting() {
  console.log('üß™ Cen√°rio: Rate Limiting');

  const resultados = {
    tentativas: 0,
    sucessos: 0,
    rate_limits: 0,
    tempo_total: 0
  };

  const inicio = Date.now();

  // Fazer 60 requisi√ß√µes em 1 minuto (sandbox permite 50/min)
  const promises = Array.from({ length: 60 }, async (_, i) => {
    try {
      resultados.tentativas++;

      const response = await fetch('https://api.debita.ai/v1/charges/pix/dynamic', {
        method: 'POST',
        headers: {
          'Authorization': `Bearer ${process.env.DEBITA_API_KEY}`,
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          amount: 1000,
          description: `Rate limit test ${i + 1}`,
          customer: {
            name: 'Rate Test',
            document: '111.444.777-35'
          }
        })
      });

      if (response.status === 429) {
        resultados.rate_limits++;
        console.log(`‚ö†Ô∏è  Rate limit na tentativa ${i + 1}`);
      } else if (response.ok) {
        resultados.sucessos++;
        console.log(`‚úÖ Sucesso na tentativa ${i + 1}`);
      }

      // Headers de rate limiting
      const remaining = response.headers.get('x-ratelimit-remaining');
      const limit = response.headers.get('x-ratelimit-limit');

      if (remaining && limit) {
        console.log(`üìä Rate limit: ${remaining}/${limit} restantes`);
      }

    } catch (error) {
      console.log(`‚ùå Erro na tentativa ${i + 1}:`, error.message);
    }

    // Delay pequeno entre requisi√ß√µes
    await new Promise(resolve => setTimeout(resolve, 50));
  });

  await Promise.all(promises);

  resultados.tempo_total = Date.now() - inicio;

  console.log('üìà Resultados do Rate Limiting:');
  console.log(`   Tentativas: ${resultados.tentativas}`);
  console.log(`   Sucessos: ${resultados.sucessos}`);
  console.log(`   Rate limits: ${resultados.rate_limits}`);
  console.log(`   Tempo total: ${resultados.tempo_total}ms`);

  return {
    cenario: 'RATE_LIMITING',
    ...resultados,
    rate_limiting_funcionando: resultados.rate_limits > 0,
    sucesso: resultados.rate_limits > 0 && resultados.sucessos < 55 // Esperado em sandbox
  };
}
```

---

## üéØ Suite de Testes Completa

### Executador de Cen√°rios

```javascript
// test-suite.js - Execute todos os cen√°rios
async function executarSuiteTestes() {
  console.log('üöÄ Iniciando Suite de Testes Completa da Debita AI\n');

  const cenarios = [
    { nome: 'PIX Din√¢mico Completo', fn: cenarioPIXCompleto },
    { nome: 'PIX Est√°tico M√∫ltiplos', fn: cenarioPIXEstatico },
    { nome: 'PIX com Fiador B2B', fn: cenarioPIXComFiador },
    { nome: 'Boleto Tradicional', fn: cenarioBoletoTradicional },
    { nome: 'Boleto H√≠brido', fn: cenarioBoletoHibrido },
    { nome: 'Webhooks Completo', fn: cenarioWebhooksCompleto },
    { nome: 'Rate Limiting', fn: cenarioRateLimiting }
  ];

  const resultados = [];
  let sucessos = 0;

  for (const cenario of cenarios) {
    try {
      console.log(`\n${'='.repeat(50)}`);
      console.log(`üß™ Executando: ${cenario.nome}`);
      console.log(`${'='.repeat(50)}`);

      const resultado = await cenario.fn();
      resultados.push(resultado);

      if (resultado.sucesso) {
        sucessos++;
        console.log(`‚úÖ ${cenario.nome}: PASSOU`);
      } else {
        console.log(`‚ùå ${cenario.nome}: FALHOU`);
      }

    } catch (error) {
      console.log(`üí• ${cenario.nome}: ERRO - ${error.message}`);
      resultados.push({
        cenario: cenario.nome,
        sucesso: false,
        erro: error.message
      });
    }
  }

  // Relat√≥rio final
  console.log(`\n${'='.repeat(60)}`);
  console.log('üìä RELAT√ìRIO FINAL DE TESTES');
  console.log(`${'='.repeat(60)}`);
  console.log(`Total de cen√°rios: ${cenarios.length}`);
  console.log(`Sucessos: ${sucessos}`);
  console.log(`Falhas: ${cenarios.length - sucessos}`);
  console.log(`Taxa de sucesso: ${((sucessos / cenarios.length) * 100).toFixed(1)}%`);

  if (sucessos === cenarios.length) {
    console.log('\nüéâ TODOS OS TESTES PASSARAM! Integra√ß√£o pronta para produ√ß√£o.');
  } else {
    console.log('\n‚ö†Ô∏è  ALGUNS TESTES FALHARAM. Verifique os logs acima.');
  }

  return {
    total: cenarios.length,
    sucessos,
    falhas: cenarios.length - sucessos,
    taxa_sucesso: (sucessos / cenarios.length) * 100,
    detalhes: resultados
  };
}

// Executar
if (require.main === module) {
  executarSuiteTestes()
    .then(relatorio => {
      console.log('\nRelat√≥rio salvo em:', './test-results.json');
      require('fs').writeFileSync(
        './test-results.json',
        JSON.stringify(relatorio, null, 2)
      );
    })
    .catch(error => {
      console.error('Erro na execu√ß√£o da suite:', error);
      process.exit(1);
    });
}
```

---

<Success>
**Sucesso**: Se todos os cen√°rios passarem, sua integra√ß√£o est√° pronta para produ√ß√£o!
</Success>

<Warning>
**Aten√ß√£o**: Execute estes testes sempre que fizer altera√ß√µes na integra√ß√£o para garantir que n√£o h√° regress√µes.
</Warning>

<Tip>
**Pr√≥ximo Passo**: Com os testes validados, configure o ambiente de produ√ß√£o seguindo nosso guia de [migra√ß√£o para produ√ß√£o](/autenticacao/ambientes).
</Tip>